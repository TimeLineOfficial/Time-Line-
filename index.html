<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>TIME LINE - Delivering Emotions On Time (Final)</title> 
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> 
  <script src="https://accounts.google.com/gsi/client" async defer></script> 
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 
  <style>
        /* Full CSS from integrated_website_v3.html */
        :root {
            --primary: #FF6B6B;
            --primary-dark: #ff5252;
            --secondary: #4ECDC4;
            --secondary-dark: #3fd8d1;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient-hover: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 15px 30px rgba(0,0,0,0.2);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 12px;
            --border-radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 10% 20%, rgba(31,31,31,0.8) 0%, rgba(18,18,18,1) 90%);
            position: relative;
            transition: background-color 0.5s ease, color 0.5s ease; /* Theme transition */
        }

        /* Particle background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        /* Header styles */
        header {
            background: var(--darker);
            text-align: center;
            padding: 2rem 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            z-index: 10;
            animation: fadeInDown 0.8s ease;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), #ff8c00, #ff6347);
            animation: rainbow 8s linear infinite;
        }

        @keyframes rainbow {
            0% {background-position: 0% 50%}
            50% {background-position: 100% 50%}
            100% {background-position: 0% 50%}
        }

        header h1 {
            margin: 0;
            color: var(--primary);
            font-size: clamp(2rem, 6vw, 3rem); /* Responsive font size */
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255,99,71,0.3);
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from {text-shadow: 0 0 10px rgba(255,99,71,0.3);}
            to {text-shadow: 0 0 20px rgba(255,99,71,0.6);}
        }

        header p {
            margin: 0.5rem 0 0;
            color: var(--light);
            font-size: clamp(1rem, 3vw, 1.2rem); /* Responsive font size */
            font-weight: 300;
            animation: fadeIn 1.5s ease;
        }

        /* Navigation */
        nav {
            background-color: rgba(31, 31, 31, 0.95);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
            animation: fadeIn 1s ease;
        }

        nav.scrolled {
            padding: 0.5rem 0;
            background-color: rgba(10, 10, 10, 0.98);
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 1rem;
            margin: 0;
            flex-wrap: wrap;
        }

        nav ul li {
            margin: 0.5rem clamp(0.5rem, 2vw, 1rem); /* Responsive margin */
            position: relative;
        }

        nav ul li::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: var(--transition);
        }

        nav ul li:hover::after {
            width: 100%;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--light);
            font-weight: 500;
            font-size: clamp(0.8rem, 2.5vw, 1rem); /* Responsive font size */
            padding: 0.5rem 0;
            transition: var(--transition);
        }

        nav ul li a:hover {
            color: var(--primary);
        }

        /* Sections */
        .section {
            padding: clamp(2rem, 8vw, 4rem) clamp(1rem, 5vw, 2rem); /* Responsive padding */
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(20px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .section:nth-child(even) {
            background-color: rgba(31, 31, 31, 0.5);
        }

        .section h2 {
            font-size: clamp(1.8rem, 5vw, 2.5rem); /* Responsive font size */
            margin-bottom: 2rem;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        .section ul {
            list-style: none;
            max-width: 800px;
            margin: 0 auto 2rem;
            text-align: left;
            padding-left: 0; /* Remove default padding */
        }

        .section ul li {
            padding: 0.8rem 0;
            position: relative;
            padding-left: 2rem;
            animation: fadeInUp 0.5s ease;
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
        }

        .section ul li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }

        .section ul li i {
            margin-right: 0.5rem;
            color: var(--primary);
        }

        /* Timeline Styles */
        .timeline {
            position: relative;
            padding: 20px 0;
            max-width: 1000px;
            margin: 0 auto;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background: var(--gradient);
            transform: translateX(-50%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 40px;
            width: 50%;
            padding: clamp(1rem, 4vw, 1.5rem); /* Responsive padding */
            box-sizing: border-box;
            background-color: rgba(31, 31, 31, 0.8);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeInUp 0.8s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .timeline-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-hover);
        }

        .timeline-item:nth-child(odd) {
            margin-left: 0;
            margin-right: auto;
            transform-origin: right center;
        }

        .timeline-item:nth-child(even) {
            margin-left: auto;
            margin-right: 0;
            transform-origin: left center;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            top: 30px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gradient);
            box-shadow: 0 0 10px rgba(255,99,71,0.5);
            animation: pulse 2s infinite alternate;
        }

        .timeline-item:nth-child(odd)::after {
            right: -10px;
        }

        .timeline-item:nth-child(even)::after {
            left: -10px;
        }

        .timeline-date {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: clamp(1rem, 3vw, 1.1rem); /* Responsive font size */
        }

        .timeline-content h3 {
            margin-top: 0;
            color: var(--primary);
            font-size: clamp(1.1rem, 4vw, 1.3rem); /* Responsive font size */
        }

        .timeline-content p {
            color: var(--light);
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
        }

        /* Form styles */
        form {
            display: flex;
            flex-direction: column;
            max-width: 600px;
            margin: 0 auto;
            padding: clamp(1.5rem, 5vw, 2rem); /* Responsive padding */
            background-color: rgba(31, 31, 31, 0.8);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.05);
            animation: fadeInUp 0.8s ease;
        }

        form:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-5px);
        }

        form label {
            margin-top: 1rem;
            text-align: left;
            color: var(--light);
            font-weight: 500;
            display: flex;
            align-items: center;
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
        }

        form input, form textarea, form select, form button {
            margin-top: 0.5rem;
            padding: clamp(0.7rem, 2vw, 0.8rem) clamp(0.8rem, 3vw, 1rem); /* Responsive padding */
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(31, 31, 31, 0.8);
            color: var(--light);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
            width: 100%; /* Ensure full width */
        }

        form input:focus, form textarea:focus, form select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
        }

        form button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: clamp(0.8rem, 2.5vw, 1rem); /* Responsive padding */
            margin-top: 1.5rem;
            border-radius: var(--border-radius-sm);
            font-size: clamp(0.9rem, 3vw, 1rem); /* Responsive font size */
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        form button:hover {
            background: var(--gradient-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        form button i {
            margin-left: 0.5rem;
        }

        form button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255,255,255,0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        form button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        /* Info styles */
        .info {
            cursor: pointer;
            color: var(--primary);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            margin-left: 0.5rem;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .info:hover {
            background: rgba(255, 107, 107, 0.3);
            transform: scale(1.1);
        }

        /* Token styles */
        .token {
            color: #ffcc00;
            font-weight: bold;
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: rgba(255, 204, 0, 0.1);
            border-radius: 5px;
            display: inline-block;
            letter-spacing: 1px;
            font-size: clamp(0.8rem, 2vw, 0.9rem); /* Responsive font size */
            word-break: break-all; /* Prevent overflow */
        }

        /* Service info */
        .service-info {
            color: var(--primary);
            font-weight: bold;
            background: rgba(255,99,71,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
            animation: pulse 2s infinite;
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
        }

        .service-info i {
            margin-right: 0.5rem;
        }

        /* Floating animation */
        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% {transform: translateY(0px);}
            50% {transform: translateY(-10px);}
            100% {transform: translateY(0px);}
        }

        /* Upload section */
        .upload-section {
            margin-top: 1.5rem;
            padding: clamp(1rem, 4vw, 1.5rem); /* Responsive padding */
            background-color: rgba(31, 31, 31, 0.5);
            border-radius: var(--border-radius-sm);
            border: 1px dashed rgba(255,255,255,0.1);
            transition: var(--transition);
        }

        .upload-section:hover {
            border-color: var(--primary);
            background-color: rgba(31, 31, 31, 0.7);
            transform: translateY(-3px);
        }

        .upload-section h3 {
            margin-top: 0;
            color: var(--primary);
            display: flex;
            align-items: center;
            font-size: clamp(1rem, 3vw, 1.1rem); /* Responsive font size */
        }

        .upload-section h3 i {
            margin-right: 0.5rem;
        }

        .upload-section p {
             font-size: clamp(0.8rem, 2.5vw, 0.9rem); /* Responsive font size */
        }

        .file-input-label {
            display: block;
            margin-bottom: 1rem;
            padding: clamp(0.8rem, 2.5vw, 1rem); /* Responsive padding */
            background: rgba(31, 31, 31, 0.5);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            border: 1px dashed rgba(255,255,255,0.1);
            font-size: clamp(0.8rem, 2.5vw, 0.9rem); /* Responsive font size */
        }

        .file-input-label:hover {
            background: rgba(31, 31, 31, 0.7);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .file-input-label input[type="file"] {
            display: none; /* Hide default file input */
        }

        /* Total amount */
        .total-amount {
            background: linear-gradient(135deg, rgba(255,99,71,0.2), rgba(255,99,71,0.1));
            padding: clamp(1rem, 4vw, 1.5rem); /* Responsive padding */
            margin: 2rem 0;
            border-radius: var(--border-radius-sm);
            font-weight: bold;
            font-size: clamp(1.1rem, 4vw, 1.3rem); /* Responsive font size */
            color: white;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,99,71,0.2);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from {box-shadow: 0 0 5px rgba(255,99,71,0.3);}
            to {box-shadow: 0 0 15px rgba(255,99,71,0.5);}
        }

        /* Company address */
        .company-address {
            background-color: rgba(31, 31, 31, 0.7);
            padding: clamp(1rem, 4vw, 1.5rem); /* Responsive padding */
            border-radius: var(--border-radius-sm);
            margin: 1.5rem 0;
            text-align: left;
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }

        .company-address:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .company-address h3 {
            margin-top: 0;
            color: var(--primary);
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            font-size: clamp(1rem, 3vw, 1.1rem); /* Responsive font size */
        }

        .company-address h3 i {
            margin-right: 0.5rem;
        }

        .company-address p {
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem); /* Responsive font size */
            word-break: break-word; /* Prevent overflow */
        }

        .company-address p i {
            margin-right: 0.5rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0; /* Prevent icon shrinking */
        }

        /* Footer */
        footer {
            background-color: var(--darker);
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
            position: relative;
            animation: fadeIn 1s ease;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient);
        }

        footer p {
            margin: 0;
            color: var(--gray);
            font-size: clamp(0.8rem, 2vw, 0.9rem); /* Responsive font size */
        }

        /* Ask button */
        #askButton {
            position: fixed;
            bottom: clamp(1rem, 4vw, 2rem); /* Responsive position */
            right: clamp(1rem, 4vw, 2rem); /* Responsive position */
            background: var(--gradient);
            color: white;
            border: none;
            width: clamp(50px, 12vw, 60px); /* Responsive size */
            height: clamp(50px, 12vw, 60px); /* Responsive size */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: var(--transition);
            animation: fadeInRight 1s ease;
        }

        #askButton:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        #askButton i {
            font-size: clamp(1.5rem, 5vw, 1.8rem); /* Responsive icon size */
        }

        /* Contact options */
        .contact-options {
            display: none;
            position: fixed;
            bottom: clamp(6rem, 18vw, 8rem); /* Responsive position */
            right: clamp(1rem, 4vw, 2rem); /* Responsive position */
            background-color: rgba(31, 31, 31, 0.95);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 99;
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.3s ease;
            width: max-content; /* Adjust width based on content */
        }

        .contact-options button {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            margin: 0.5rem 0;
            padding: clamp(0.6rem, 2vw, 0.8rem) clamp(1rem, 3vw, 1.5rem); /* Responsive padding */
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: clamp(0.8rem, 2.5vw, 0.9rem); /* Responsive font size */
        }

        .contact-options button:hover {
            background: var(--primary);
            transform: translateX(-5px);
        }

        .contact-options button i {
            margin-right: 0.5rem;
        }

        /* Popup */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(31, 31, 31, 0.95);
            padding: clamp(1.5rem, 5vw, 2rem); /* Responsive padding */
            border-radius: var(--border-radius);
            z-index: 1001;
            box-shadow: var(--shadow-hover);
            max-width: 90%;
            width: clamp(300px, 80vw, 400px); /* Responsive width */
            text-align: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .popup p {
            margin-bottom: 1.5rem;
            font-size: clamp(1rem, 3vw, 1.1rem); /* Responsive font size */
        }

        .popup button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: clamp(0.7rem, 2vw, 0.8rem) clamp(1.2rem, 4vw, 1.5rem); /* Responsive padding */
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
        }

        .popup button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Google login container */
        #google-login-container {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
            animation: fadeIn 1s ease;
        }
        /* Ensure Google button scales */
        #google-login-container > div {
            width: auto !important; /* Override fixed width */
            max-width: 100%;
        }

        /* User info */
        .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 1rem 0;
            padding: clamp(0.8rem, 2.5vw, 1rem); /* Responsive padding */
            background: rgba(31, 31, 31, 0.7);
            border-radius: var(--border-radius-sm);
            animation: fadeIn 1s ease;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .user-info img {
            width: clamp(30px, 8vw, 40px); /* Responsive size */
            height: clamp(30px, 8vw, 40px); /* Responsive size */
            border-radius: 50%;
            margin-right: 1rem;
        }

        .user-info span {
            font-weight: 500;
            flex-grow: 1;
            font-size: clamp(0.9rem, 2.5vw, 1rem); /* Responsive font size */
            margin-right: 1rem; /* Space before button */
            word-break: break-all; /* Prevent overflow */
        }

        .user-info button {
            margin-left: auto; /* Push button to the right */
            background: rgba(255, 107, 107, 0.2);
            color: var(--primary);
            border: none;
            padding: clamp(0.4rem, 1.5vw, 0.5rem) clamp(0.8rem, 2.5vw, 1rem); /* Responsive padding */
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: clamp(0.8rem, 2vw, 0.9rem); /* Responsive font size */
            flex-shrink: 0; /* Prevent button shrinking */
        }

        .user-info button:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        /* Order count warning */
        .order-count-warning {
            color: var(--warning);
            background: rgba(255, 193, 7, 0.1);
            padding: clamp(0.6rem, 2vw, 0.8rem); /* Responsive padding */
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--warning);
            margin: 1rem 0;
            display: flex;
            align-items: center;
            animation: fadeIn 1s ease;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem); /* Responsive font size */
        }

        .order-count-warning i {
            margin-right: 0.5rem;
        }

        /* Price tag */
        .price-tag {
            background: var(--gradient);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-right: 0.5rem;
            font-weight: bold;
            font-size: clamp(0.8rem, 2vw, 0.9rem); /* Responsive font size */
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: clamp(150px, 40vw, 200px); /* Responsive width */
            background-color: var(--darker);
            color: #fff;
            text-align: center;
            border-radius: var(--border-radius-sm);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-size: clamp(0.8rem, 2vw, 0.9rem); /* Responsive font size */
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Theme toggle */
        #themeToggle {
            position: fixed;
            top: clamp(10px, 3vw, 20px); /* Responsive position */
            right: clamp(10px, 3vw, 20px); /* Responsive position */
            background: var(--gradient);
            color: white;
            border: none;
            width: clamp(35px, 8vw, 40px); /* Responsive size */
            height: clamp(35px, 8vw, 40px); /* Responsive size */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: var(--transition);
        }

        #themeToggle:hover {
            transform: rotate(30deg);
        }

        /* 3D Card Effect */
        .card-3d {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card-3d-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card-3d:hover .card-3d-inner {
            transform: rotateY(5deg) rotateX(5deg);
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background: var(--gradient);
            transition: width 0.3s ease;
        }

        /* Responsive styles for Timeline */
        @media (max-width: 768px) {
            .timeline::before {
                left: 20px;
            }
            
            .timeline-item {
                width: 100%;
                padding-left: 50px;
                padding-right: 20px;
            }
            
            .timeline-item:nth-child(odd),
            .timeline-item:nth-child(even) {
                margin-left: 0;
                margin-right: 0;
            }
            
            .timeline-item::after {
                left: 10px;
            }
        }

        /* Dark/Light mode */
        body.light-mode {
            background-color: #f5f5f5;
            color: #333;
            background-image: radial-gradient(circle at 10% 20%, rgba(240,240,240,0.8) 0%, rgba(255,255,255,1) 90%);
        }

        body.light-mode .section:nth-child(even) {
            background-color: rgba(240, 240, 240, 0.5);
        }

        body.light-mode header,
        body.light-mode footer,
        body.light-mode nav {
            background-color: #fff;
            color: #333;
        }

        body.light-mode nav ul li a {
            color: #333;
        }

        body.light-mode form,
        body.light-mode .timeline-item,
        body.light-mode .company-address,
        body.light-mode .popup,
        body.light-mode .contact-options {
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            border-color: rgba(0,0,0,0.1);
        }

        body.light-mode form input,
        body.light-mode form textarea,
        body.light-mode form select {
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            border-color: rgba(0,0,0,0.1);
        }

        body.light-mode .section h2,
        body.light-mode .timeline-date,
        body.light-mode .timeline-content h3,
        body.light-mode .company-address h3 {
            color: var(--primary-dark);
        }

        body.light-mode footer p {
            color: #666;
        }

        body.light-mode .token {
            color: #b38f00;
            background: rgba(255, 204, 0, 0.2);
        }

        body.light-mode .tooltip .tooltiptext {
            background-color: #f0f0f0;
            color: #333;
            border-color: rgba(0,0,0,0.1);
        }

        /* Ensure checkbox label is clickable */
        form label input[type="checkbox"] {
            margin-right: 0.5rem;
            width: auto; /* Override default width */
        }

        /* Instruction text styling */
        .instruction {
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            color: var(--gray);
            margin-top: 0.5rem;
            text-align: left;
        }

        body.light-mode .instruction {
            color: #555;
        }

    </style> 
 </head> 
 <body> 
  <div id="particles-js"></div> <button id="themeToggle" title="Toggle Dark/Light Mode"> <i class="fas fa-moon"></i> </button> 
  <header class="animate__animated animate__fadeIn"> 
   <div class="logo"> 
    <h1>TIME LINE</h1> 
    <p>Delivering Emotions On Time</p> 
   </div> 
  </header> 
  <nav id="mainNav" class="animate__animated animate__fadeIn animate__delay-1s"> 
   <ul> 
    <li><a href="#home">Home</a></li> 
    <li><a href="#features">Features</a></li> 
    <li><a href="#timeline">Our Story</a></li> 
    <li><a href="#order">Order Now</a></li> 
    <li><a href="#price">Price</a></li> 
    <li><a href="#policy">Policy</a></li> 
    <li><a href="#contact">Contact</a></li> 
   </ul> 
  </nav> 
  <section id="home" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Welcome to TIME LINE</h2> 
   <p class="animate__animated animate__fadeInUp animate__delay-1s">Delivering emotions, surprises, and gifts to your loved ones on time.</p> 
  </section> 
  <section id="features" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Why Choose Us?</h2> 
   <ul class="animate__animated animate__fadeInUp animate__delay-1s"> 
    <li><i class="fas fa-calendar-check"></i> Specific date and time delivery</li> 
    <li><i class="fas fa-envelope-open-text"></i> Personalized message reading</li> 
    <li><i class="fas fa-video"></i> Live delivery viewing via video call</li> 
    <li><i class="fas fa-pen-fancy"></i> Handwritten or printed letters</li> 
    <li><i class="fas fa-shield-alt"></i> Secure and reliable service</li> 
   </ul> 
   <p class="service-info floating animate__animated animate__pulse animate__infinite"> <i class="fas fa-info-circle"></i> This service is currently available only in Varanasi and Chandauli. </p> 
  </section> <!-- Timeline Section --> 
  <section id="timeline" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Our Journey</h2> 
   <div class="timeline"> 
    <div class="timeline-item card-3d animate__animated animate__fadeInLeft"> 
     <div class="card-3d-inner"> 
      <div class="timeline-date">
       January 2023
      </div> 
      <div class="timeline-content"> 
       <h3>Time Line Founded</h3> 
       <p>Started with a vision to deliver emotions and surprises at the perfect moment.</p> 
      </div> 
     </div> 
    </div> 
    <div class="timeline-item card-3d animate__animated animate__fadeInRight"> 
     <div class="card-3d-inner"> 
      <div class="timeline-date">
       March 2023
      </div> 
      <div class="timeline-content"> 
       <h3>First 100 Deliveries</h3> 
       <p>Successfully completed our first 100 deliveries with 100% customer satisfaction.</p> 
      </div> 
     </div> 
    </div> 
    <div class="timeline-item card-3d animate__animated animate__fadeInLeft"> 
     <div class="card-3d-inner"> 
      <div class="timeline-date">
       June 2023
      </div> 
      <div class="timeline-content"> 
       <h3>Expanded to Chandauli</h3> 
       <p>Extended our services to Chandauli district after success in Varanasi.</p> 
      </div> 
     </div> 
    </div> 
    <div class="timeline-item card-3d animate__animated animate__fadeInRight"> 
     <div class="card-3d-inner"> 
      <div class="timeline-date">
       December 2023
      </div> 
      <div class="timeline-content"> 
       <h3>1000+ Happy Customers</h3> 
       <p>Celebrated serving over 1000 customers with our unique delivery service.</p> 
      </div> 
     </div> 
    </div> 
   </div> 
  </section> 
  <section id="order" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Place Your Order</h2> <!-- Form Progress Bar --> 
   <div class="progress-container animate__animated animate__fadeIn"> 
    <div class="progress-bar" id="formProgress"></div> 
   </div> <!-- Google Login Container --> 
   <div id="google-login-container"></div> <!-- User Info Display --> 
   <div id="user-info" class="user-info" style="display: none;"> 
    <img id="user-pic" src="" alt="User picture"> <span id="user-name"></span> <button id="sign-out-button">Sign Out</button> 
   </div> <!-- Order Limit Warning --> 
   <div id="order-limit-warning" class="order-count-warning" style="display: none;"> <i class="fas fa-exclamation-circle"></i> You've reached your limit of 2 orders in 24 hours. Please try again later. 
   </div> 
   <form id="orderForm" class="animate__animated animate__fadeInUp animate__delay-1s"> <label for="customerName">Your Name (Optional):</label> 
    <input type="text" id="customerName" name="customerName" placeholder="Leave blank for a random token"> 
    <p id="tokenDisplay" class="token"></p> <label for="phoneNumber">Your Phone Number:</label> 
    <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="Enter your 10-digit phone number" pattern="^[0-9]{10}$" required> <label for="photoUpload" class="file-input-label"> <i class="fas fa-camera"></i> Upload Photo <span class="info tooltip">?<span class="tooltiptext">This helps us better identify the recipient during delivery</span></span> <input type="file" id="photoUpload" name="photoUpload" accept="image/*"> </label> <label for="recipientName">Recipient's Name:</label> 
    <input type="text" id="recipientName" name="recipientName" required> <label for="recipientPhoneNumber">Recipient's Phone Number (Optional):</label> 
    <input type="tel" id="recipientPhoneNumber" name="recipientPhoneNumber" placeholder="Enter recipient's 10-digit phone number" pattern="^[0-9]{10}$"> <label for="address">Recipient's Address:</label> <textarea id="address" name="address" rows="3" required></textarea> <label for="district">District:</label> <select id="district" name="district" required> <option value="Varanasi">Varanasi</option> <option value="Chandauli">Chandauli</option> </select> <label for="state">State:</label> <select id="state" name="state" required> <option value="Uttar Pradesh">Uttar Pradesh</option> </select> <label for="pincode">Pin Code:</label> 
    <input type="text" id="pincode" name="pincode" pattern="^[0-9]{6}$" required> <label for="itemType">Item Type:</label> <select id="itemType" name="itemType" required> <option value="">-- Select Item Type --</option> <option value="message">Message (Speak in front of Recipient)</option> <option value="writtenByTimeline">Letter written by Time Line (In Your Words)</option> <option value="itemsSendByCustomer">Items (Send by Customer)</option> <option value="itemsBuyByTimeline">Items (Buy by Time Line)</option> </select> <!-- Dynamic sections will appear here --> 
    <div id="additionalSections"></div> 
    <div id="totalAmount" class="total-amount">
     Total Amount: ₹0
    </div> <label for="deliveryDate">Delivery Date:</label> 
    <input type="date" id="deliveryDate" name="deliveryDate" required> <label for="deliveryTime">Delivery Time:</label> 
    <input type="time" id="deliveryTime" name="deliveryTime" required> <label> <input type="checkbox" id="liveDelivery" name="liveDelivery"> Check to see live/recorded delivery </label> <!-- Dynamic live delivery options will appear here --> 
    <div id="liveDeliveryOptions"></div> 
    <div class="company-address"> 
     <h3><i class="fas fa-map-marker-alt"></i> Our Office Address (For Item Drop-off):</h3> 
     <p><i class="fas fa-building"></i> Time Line Office, Parle-G factory, Patanava</p> 
     <p><i class="fas fa-industry"></i> Ramnagar industrial area, Ramnagar</p> 
     <p><i class="fas fa-city"></i> Varanasi, Uttar Pradesh - 221008</p> 
     <p><i class="fas fa-phone"></i> Contact: 7007677139 (Call/WhatsApp)</p> 
     <p><i class="fas fa-envelope"></i> Email: timelinedeliveryofficial@gmail.com</p> 
    </div> <button type="submit" id="submit-button">Proceed to Payment <i class="fas fa-arrow-right"></i></button> 
   </form> 
  </section> 
  <section id="price" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Price List</h2> 
   <ul class="animate__animated animate__fadeInUp animate__delay-1s"> 
    <li><span class="price-tag">₹249</span> Normal delivery (Including letters, Voice message, small gifts, etc)</li> 
    <li><span class="price-tag">₹299</span> Items Delivery (Send by customer or buy by Time Line)</li> 
   </ul> 
   <div class="service-info"> 
    <p><i class="fas fa-info-circle"></i> All deliveries include specific acts like Singing, shayari, Confession, etc.</p> 
    <p><i class="fas fa-clock"></i> All services completed in less than 15 minutes</p> 
   </div> 
  </section> 
  <section id="policy" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Policy</h2> 
   <ul class="animate__animated animate__fadeInUp animate__delay-1s"> 
    <li><i class="fas fa-undo"></i> <strong>Refund Policy:</strong> If delivery fails, the amount (excluding distance charges) will be refunded within twelve hours.</li> 
    <li><i class="fas fa-truck"></i> <strong>Return Policy:</strong> If the customer wants the parcel back, they must pay courier charges for retrieval and ₹20 extra for convenience charges.</li> 
    <li><i class="fas fa-shield-alt"></i> <strong>Warranty Policy:</strong> For warranty claims on items sent by customer, we'll record opening the package and refund full amount (excluding ₹100 fuel charge) if items are damaged/missing.</li> 
   </ul> 
  </section> 
  <section id="contact" class="section"> 
   <h2 class="animate__animated animate__fadeInUp">Contact Us</h2> 
   <div class="card-3d animate__animated animate__fadeInUp animate__delay-1s"> 
    <div class="card-3d-inner company-address" style="border-left: none; text-align: center;"> 
     <p><i class="fas fa-envelope"></i> Email: <a href="mailto:timelinedeliveryofficial@gmail.com">timelinedeliveryofficial@gmail.com</a></p> 
     <p><i class="fab fa-instagram"></i> Instagram: <a href="https://www.instagram.com/time_line.official?igsh=MTZoaDYwb25wOWdkbw==" target="_blank">@time_line.official</a></p> 
     <p><i class="fas fa-map-marker-alt"></i> Address: Time Line Office, Parle-G factory, Patanava, Ramnagar industrial area, Ramnagar, Varanasi, Uttar Pradesh, 221008</p> 
     <p><i class="fas fa-phone"></i> Contact no.: 7007677139 (Call/WhatsApp)</p> 
    </div> 
   </div> 
  </section> 
  <footer> 
   <p>© 2025 TIME LINE. All Rights Reserved.</p> 
  </footer> <button id="askButton"><i class="fas fa-comment-dots"></i></button> 
  <div id="contactOptions" class="contact-options"> <button onclick="redirectToWhatsApp()"> <i class="fab fa-whatsapp"></i> WhatsApp </button> <button onclick="redirectToInstagram()"> <i class="fab fa-instagram"></i> Instagram </button> <button onclick="redirectToGmail()"> <i class="fas fa-envelope"></i> Gmail </button> <button onclick="hideContactOptions()"> <i class="fas fa-times"></i> Close </button> 
  </div> 
  <div id="popup" class="popup"> 
   <p id="popupMessage"></p> <button onclick="closePopup()">OK</button> 
  </div> <!-- Particles.js for background effects --> 
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script> 
  <script>
        // Supabase initialization
        const supabaseUrl = 'https://hseqvitreugkqgumgffa.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhzZXF2aXRyZXVna3FndW1nZmZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MzY5MzUsImV4cCI6MjA2MDExMjkzNX0.p3qK1ojwxbfQBWVD_KIFVNuPveY6-rFs2gkKAJQshPo';
        
        // Google Apps Script URL from v37
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5wtRs_ShNdA4vx8QjGXVdT_rBFcdWlvQVIGy_ypHiZtwUUWFQ71eodoJfVOP3mtav/exec';
        
        // Initialize Supabase client
        let supabase = null;
        try {
             supabase = supabase.createClient(supabaseUrl, supabaseKey);
        } catch (error) {
            console.error("Supabase initialization failed:", error);
        }
       
        
        // Global variables
        let currentUser = null;
        let userOrders = [];
        let formProgress = 0;
        
        // Generate Random Alphanumeric Token
        function generateToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let token = '';
            for (let i = 0; i < 8; i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return token;
        }
        
        // Convert file to Base64
        async function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve({
                    filename: file.name,
                    mimeType: file.type,
                    content: reader.result.split(',')[1]
                });
                reader.onerror = error => reject(error);
            });
        }
        
        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            if (typeof google === 'undefined' || typeof google.accounts === 'undefined') {
                console.error('Google Sign-In library not loaded.');
                return;
            }
            try {
                google.accounts.id.initialize({
                    client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with your actual Client ID
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });
                
                google.accounts.id.renderButton(
                    document.getElementById('google-login-container'),
                    { 
                        theme: 'filled_blue', 
                        size: 'large',
                        width: '300',
                        text: 'continue_with',
                        shape: 'pill'
                    }
                );
            } catch (error) {
                 console.error("Google Sign-In initialization failed:", error);
            }
        }
        
        // Handle Google Sign-In Response
        async function handleCredentialResponse(response) {
            try {
                const userInfo = await verifyGoogleToken(response.credential);
                currentUser = {
                    id: userInfo.sub,
                    name: userInfo.name,
                    email: userInfo.email,
                    picture: userInfo.picture
                };
                
                displayUserInfo();
                checkOrderLimit();
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateFormProgress(20);
            } catch (error) {
                showPopup('Error signing in with Google. Please try again.');
                console.error('Google Sign-In Error:', error);
            }
        }
        
        // Verify Google Token (mock function - replace with backend verification if needed)
        async function verifyGoogleToken(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }
        
        // Display User Info
        function displayUserInfo() {
            const userInfoDiv = document.getElementById('user-info');
            const userPic = document.getElementById('user-pic');
            const userName = document.getElementById('user-name');
            
            if (currentUser && userInfoDiv && userPic && userName) {
                userInfoDiv.style.display = 'flex';
                userPic.src = currentUser.picture;
                userName.textContent = currentUser.name;
            } else if (userInfoDiv) {
                userInfoDiv.style.display = 'none';
            }
        }
        
        // Sign Out
        function signOut() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            displayUserInfo();
            showPopup('You have been signed out.');
            updateFormProgress(-20);
            // Optionally, re-render the Google Sign-In button if needed
            const googleContainer = document.getElementById('google-login-container');
            if (googleContainer) {
                googleContainer.innerHTML = ''; // Clear previous button
                initializeGoogleSignIn(); // Re-render
            }
        }
        
        // Check Order Limit
        async function checkOrderLimit() {
            if (!currentUser || !supabase) return;
            
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact' })
                    .eq('user_id', currentUser.id)
                    .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());
                
                if (error) throw error;
                
                userOrders = data || [];
                
                const orderLimitWarning = document.getElementById('order-limit-warning');
                const submitButton = document.getElementById('submit-button');
                
                if (userOrders.length >= 2) {
                    if (orderLimitWarning) orderLimitWarning.style.display = 'flex';
                    if (submitButton) {
                        submitButton.disabled = true;
                        submitButton.style.opacity = '0.5';
                        submitButton.style.cursor = 'not-allowed';
                    }
                } else {
                    if (orderLimitWarning) orderLimitWarning.style.display = 'none';
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.style.opacity = '1';
                        submitButton.style.cursor = 'pointer';
                    }
                }
            } catch (error) {
                console.error('Error checking order limit:', error);
            }
        }
        
        // Store Order in Supabase
        async function storeOrderSupabase(orderData) {
             if (!currentUser || !supabase) return false;
            
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .insert([
                        {
                            user_id: currentUser.id,
                            user_email: currentUser.email,
                            customer_name: orderData.customerName || document.getElementById('tokenDisplay')?.textContent.replace('Your Token: ', ''),
                            phone_number: orderData.phoneNumber,
                            recipient_name: orderData.recipientName,
                            recipient_phone: orderData.recipientPhoneNumber,
                            address: orderData.address,
                            district: orderData.district,
                            state: orderData.state,
                            pincode: orderData.pincode,
                            item_type: orderData.itemType,
                            delivery_date: orderData.deliveryDate,
                            delivery_time: orderData.deliveryTime,
                            live_delivery: orderData.liveDelivery || false,
                            total_amount: orderData.totalAmount,
                            status: 'pending'
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                const photoFile = document.getElementById('photoUpload')?.files[0];
                if (photoFile && data && data[0]) {
                    const fileExt = photoFile.name.split('.').pop();
                    const fileName = `${currentUser.id}_${Date.now()}.${fileExt}`;
                    const { error: uploadError } = await supabase
                        .storage
                        .from('customer-photos') // Ensure this bucket exists and has correct policies
                        .upload(`orders/${fileName}`, photoFile);
                    
                    if (uploadError) {
                        console.warn('Photo upload to Supabase failed:', uploadError);
                    } else {
                        const { data: publicUrlData, error: urlError } = supabase
                            .storage
                            .from('customer-photos')
                            .getPublicUrl(`orders/${fileName}`);
                        
                        if (urlError) {
                            console.warn('Failed to get public URL for photo:', urlError);
                        } else {
                             await supabase
                                .from('orders')
                                .update({ recipient_photo: publicUrlData.publicUrl })
                                .eq('id', data[0].id);
                        }
                    }
                }
                
                return true;
            } catch (error) {
                console.error('Error storing order in Supabase:', error);
                return false;
            }
        }
        
        // Submit form data to Google Sheets
        async function submitFormDataGoogle(formData) {
            const tokenNumber = document.getElementById("tokenDisplay")?.textContent.replace("Your Token: ", "") || generateToken();
            const submission = {
                tokenNumber: tokenNumber,
                customerName: formData.customerName,
                phoneNumber: formData.phoneNumber,
                recipientName: formData.recipientName,
                recipientPhoneNumber: formData.recipientPhoneNumber,
                address: formData.address,
                district: formData.district,
                state: formData.state,
                pincode: formData.pincode,
                itemType: formData.itemType,
                deliveryDate: formData.deliveryDate,
                deliveryTime: formData.deliveryTime,
                liveDelivery: document.getElementById("liveDelivery")?.checked || false,
                totalAmount: calculateTotalAmount()
            };

            const messageText = document.querySelector('textarea[name="message"]')?.value;
            if (messageText) submission.messageText = messageText;
            
            const productDescription = document.querySelector('textarea[name="productDescription"]')?.value;
            if (productDescription) submission.productDescription = productDescription;
            
            const productPrice = document.getElementById("productPrice")?.value;
            if (productPrice) submission.productPrice = productPrice;
            
            const productLink = document.querySelector('input[name="productLink"]astaudio')?.value;
            if (productLink) submission.productLink = productLink;
            
            const instructions = document.querySelector('textarea[name="instructions"]astaudio')?.value;
            if (instructions) submission.instructions = instructions;
            
            if (document.getElementById("claimWarranty")?.checked) submission.claimWarranty = true;
            
            if (document.getElementById("liveDelivery")?.checked) {
                submission.deliveryMethod = document.getElementById("deliveryMethod")?.value;
                submission.platform = document.getElementById("platform")?.value;
                const platformDetailsInput = document.getElementById(
                    submission.platform === 'whatsapp' ? 'whatsappNumber' :
                    submission.platform === 'googleMeet' ? 'email' : 'instagramId'
                );
                if (platformDetailsInput) submission.platformDetails = platformDetailsInput.value;
            }

            const filesToUpload = [
                { inputId: 'photoUpload', field: 'photo' },
                { inputId: 'messageAudio', field: 'messageAudio' },
                { inputId: 'messageVideo', field: 'messageVideo' },
                { inputId: 'instructionAudio', field: 'instructionAudio' }
            ];

            for (const fileInfo of filesToUpload) {
                const fileInput = document.querySelector(`input[name="${fileInfo.inputId}"]`);
                if (fileInput?.files[0]) {
                    try {
                        submission[fileInfo.field] = await toBase64(fileInput.files[0]);
                    } catch (error) {
                        console.error(`Error processing ${fileInfo.inputId}:`, error);
                    }
                }
            }

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    // mode: 'no-cors', // Use this if CORS issues persist and you don't need the response
                    body: JSON.stringify(submission),
                    headers: { 'Content-Type': 'application/json' }
                });
                
                // If using 'no-cors', you won't get a readable response here
                // Assume success if the request doesn't throw an error
                // const result = await response.json(); 
                // if (result.status === 'success') { ... }
                
                // For now, assume success if fetch completes without error
                localStorage.setItem(`order_${tokenNumber}`, 'submitted_via_google_script'); // Store minimal confirmation
                return true;

            } catch (err) {
                console.error('Submission error to Google Apps Script:', err);
                showPopup('Error submitting form via Google Script: ' + err.message);
                return false;
            }
        }
        
        // Calculate total amount based on selections
        function calculateTotalAmount() {
            const itemTypeSelect = document.getElementById("itemType");
            const totalAmountDiv = document.getElementById("totalAmount");
            if (!itemTypeSelect || !totalAmountDiv) return 0;

            const itemType = itemTypeSelect.value;
            let amount = 0;
            
            if (itemType === "message" || itemType === "writtenByTimeline") {
                amount = 249;
            } else if (itemType === "itemsSendByCustomer") {
                amount = 299;
            } else if (itemType === "itemsBuyByTimeline") {
                const productPriceInput = document.getElementById("productPrice");
                const productPrice = parseFloat(productPriceInput?.value) || 0;
                amount = 299 + productPrice;
            }
            
            totalAmountDiv.textContent = `Total Amount: ₹${amount}`;
            return amount;
        }
        
        // Set minimum delivery date and time
        function setMinDeliveryTime() {
            const dateInput = document.getElementById('deliveryDate');
            if (!dateInput) return;

            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const minDate = tomorrow.toISOString().split('T')[0];
            dateInput.min = minDate;
            // Set default value only if current value is empty or invalid
            if (!dateInput.value || dateInput.value < minDate) {
                 dateInput.value = minDate;
            }
        }
        
        // Update form progress bar
        function updateFormProgress(increment) {
            const progressBar = document.getElementById('formProgress');
            if (!progressBar) return;
            formProgress = Math.max(0, Math.min(100, formProgress + increment));
            progressBar.style.width = formProgress + '%';
        }
        
        // Show popup message
        function showPopup(message) {
            const popupMessage = document.getElementById('popupMessage');
            const popup = document.getElementById('popup');
            if (popupMessage && popup) {
                popupMessage.textContent = message;
                popup.style.display = 'block';
            }
        }
        
        // Close popup
        function closePopup() {
            const popup = document.getElementById('popup');
            if (popup) popup.style.display = 'none';
        }
        
        // Show contact options
        function showContactOptions() {
            const contactOptions = document.getElementById('contactOptions');
            if (contactOptions) contactOptions.style.display = 'block';
        }
        
        // Hide contact options
        function hideContactOptions() {
            const contactOptions = document.getElementById('contactOptions');
            if (contactOptions) contactOptions.style.display = 'none';
        }
        
        // Redirect to WhatsApp
        function redirectToWhatsApp() {
            window.open('https://wa.me/917007677139', '_blank');
        }
        
        // Redirect to Instagram
        function redirectToInstagram() {
            window.open('https://www.instagram.com/time_line.official?igsh=MTZoaDYwb25wOWdkbw==', '_blank');
        }
        
        // Redirect to Gmail
        function redirectToGmail() {
            window.open('mailto:timelinedeliveryofficial@gmail.com', '_blank');
        }
        
        // Copy address to clipboard
        function copyAddress() {
            const address = "Time Line Office, Parle-G factory, Patanava, Ramnagar industrial area, Ramnagar, Varanasi, Uttar Pradesh, 221008";
            navigator.clipboard.writeText(address).then(() => {
                showPopup('Address copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                showPopup('Failed to copy address.');
            });
        }

        // Function to handle platform selection change
        function handlePlatformChange() {
            const platformSelect = document.getElementById("platform");
            const platformDetails = document.getElementById("platformDetails");
            if (!platformSelect || !platformDetails) return;

            const platform = platformSelect.value;
            console.log("Platform changed to:", platform);

            switch (platform) {
                case 'whatsapp':
                    platformDetails.innerHTML = `
                        <label for="whatsappNumber">Fill Your WhatsApp Number:</label>
                        <input type="tel" id="whatsappNumber" name="whatsappNumber" placeholder="Enter your 10-digit WhatsApp number" pattern="^[0-9]{10}$" required>
                    `;
                    break;
                case 'googleMeet':
                    platformDetails.innerHTML = `
                        <label for="email">Enter your Email:</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    `;
                    break;
                case 'instagram':
                    platformDetails.innerHTML = `
                        <label for="instagramId">Enter your Instagram ID:</label>
                        <input type="text" id="instagramId" name="instagramId" placeholder="Enter your Instagram ID" required>
                    `;
                    break;
                default:
                    platformDetails.innerHTML = '';
                    break;
            }
        }

        // Function to handle item type change
        function handleItemTypeChange() {
            const itemTypeSelect = document.getElementById("itemType");
            const additionalSections = document.getElementById("additionalSections");
            if (!itemTypeSelect || !additionalSections) return;

            const selectedItemType = itemTypeSelect.value;
            console.log("Item type changed to:", selectedItemType);

            // Clear previous dynamic content and listeners
            additionalSections.innerHTML = ''; 

            switch (selectedItemType) {
                case 'message':
                case 'writtenByTimeline':
                    additionalSections.innerHTML = `
                        <h3>Write Your Message</h3>
                        <textarea name="message" rows="4" placeholder="Write your message here..." required></textarea>
                        <div class="upload-section">
                            <h3><i class="fas fa-envelope"></i> Your Message (Optional) <span class="info tooltip">?<span class="tooltiptext">This will be played during delivery</span></span></h3>
                            <p>Upload an audio or video message to be played during delivery</p>
                            <label class="file-input-label">
                                <i class="fas fa-file-audio"></i> Upload Audio (max 50MB)
                                <input type="file" name="messageAudio" accept="audio/*">
                            </label>
                            <label class="file-input-label">
                                <i class="fas fa-file-video"></i> Upload Video (max 200MB, MP4/MKV)
                                <input type="file" name="messageVideo" accept="video/mp4,video/x-matroska">
                            </label>
                        </div>
                        <div class="upload-section">
                            <h3><i class="fas fa-clipboard-list"></i> Delivery Instructions <span class="info tooltip">?<span class="tooltiptext">Instructions for our delivery person</span></span></h3>
                            <p>Write or record instructions for the delivery person (at least one required)</p>
                            <textarea name="instructions" rows="3" placeholder="Write your delivery instructions here..."></textarea>
                            <label class="file-input-label">
                                <i class="fas fa-microphone"></i> Or Upload Audio Instructions (max 10MB)
                                <input type="file" name="instructionAudio" accept="audio/*">
                            </label>
                        </div>
                    `;
                    break;
                case 'itemsSendByCustomer':
                    additionalSections.innerHTML = `
                        <h3>Send Item At</h3>
                        <textarea rows="3" readonly>Time Line Office, Parle-G factory, Patanava, Ramnagar industrial area, Ramnagar, Varanasi, Uttar Pradesh, 221008</textarea>
                        <button type="button" onclick="copyAddress()" class="animate__animated animate__pulse">Copy Address <i class="fas fa-copy"></i></button>
                        <p class="instruction">Please write your token number on the delivery package for better identification.</p>
                        <div class="upload-section">
                            <h3><i class="fas fa-envelope"></i> Your Message (Optional) <span class="info tooltip">?<span class="tooltiptext">This will be played during delivery</span></span></h3>
                            <p>Upload an audio or video message to be played during delivery</p>
                            <label class="file-input-label">
                                <i class="fas fa-file-audio"></i> Upload Audio (max 50MB)
                                <input type="file" name="messageAudio" accept="audio/*">
                            </label>
                            <label class="file-input-label">
                                <i class="fas fa-file-video"></i> Upload Video (max 200MB, MP4/MKV)
                                <input type="file" name="messageVideo" accept="video/mp4,video/x-matroska">
                            </label>
                        </div>
                        <div class="upload-section">
                            <h3><i class="fas fa-clipboard-list"></i> Delivery Instructions <span class="info tooltip">?<span class="tooltiptext">Instructions for our delivery person</span></span></h3>
                            <p>Write or record instructions for the delivery person (at least one required)</p>
                            <textarea name="instructions" rows="3" placeholder="Write your delivery instructions here..."></textarea>
                            <label class="file-input-label">
                                <i class="fas fa-microphone"></i> Or Upload Audio Instructions (max 10MB)
                                <input type="file" name="instructionAudio" accept="audio/*">
                            </label>
                        </div>
                        <label><input type="checkbox" id="claimWarranty" name="claimWarranty"> Claim Warranty <span class="info tooltip">?<span class="tooltiptext">We'll record opening the package for warranty claims</span></span></label>
                    `;
                    break;
                case 'itemsBuyByTimeline':
                    additionalSections.innerHTML = `
                        <h3>Describe Your Product</h3>
                        <textarea name="productDescription" rows="4" placeholder="Describe your product..." required></textarea>
                        <h3>Product Price</h3>
                        <input type="number" id="productPrice" name="productPrice" placeholder="Enter estimated product price" required>
                        <p class="instruction">Please enter slightly higher amount than actual price as product may be available at higher rate in our area. If we get it cheaper, we'll refund the difference within 24 hours.</p>
                        <h3>Optional: Product Link</h3>
                        <input type="url" name="productLink" placeholder="Paste the product link here">
                        <div class="upload-section">
                            <h3><i class="fas fa-envelope"></i> Your Message (Optional) <span class="info tooltip">?<span class="tooltiptext">This will be played during delivery</span></span></h3>
                            <p>Upload an audio or video message to be played during delivery</p>
                            <label class="file-input-label">
                                <i class="fas fa-file-audio"></i> Upload Audio (max 50MB)
                                <input type="file" name="messageAudio" accept="audio/*">
                            </label>
                            <label class="file-input-label">
                                <i class="fas fa-file-video"></i> Upload Video (max 200MB, MP4/MKV)
                                <input type="file" name="messageVideo" accept="video/mp4,video/x-matroska">
                            </label>
                        </div>
                        <div class="upload-section">
                            <h3><i class="fas fa-clipboard-list"></i> Delivery Instructions <span class="info tooltip">?<span class="tooltiptext">Instructions for our delivery person</span></span></h3>
                            <p>Write or record instructions for the delivery person (at least one required)</p>
                            <textarea name="instructions" rows="3" placeholder="Write your delivery instructions here..."></textarea>
                            <label class="file-input-label">
                                <i class="fas fa-microphone"></i> Or Upload Audio Instructions (max 10MB)
                                <input type="file" name="instructionAudio" accept="audio/*">
                            </label>
                        </div>
                    `;
                    // Add event listener for product price *after* the element is added to the DOM
                    const productPriceInput = document.getElementById("productPrice");
                    if (productPriceInput) {
                        productPriceInput.addEventListener("input", calculateTotalAmount);
                    }
                    break;
                default:
                    // Already cleared above
                    break;
            }
            // Recalculate amount after changing sections
            calculateTotalAmount(); 
        }

        // Function to handle live delivery checkbox change
        function handleLiveDeliveryChange() {
            const liveDeliveryCheckbox = document.getElementById("liveDelivery");
            const liveDeliveryOptions = document.getElementById("liveDeliveryOptions");
            if (!liveDeliveryCheckbox || !liveDeliveryOptions) return;

            console.log("Live delivery checkbox changed:", liveDeliveryCheckbox.checked);

            if (liveDeliveryCheckbox.checked) {
                liveDeliveryOptions.innerHTML = `
                    <label for="deliveryMethod">Delivery Method:</label>
                    <select id="deliveryMethod" name="deliveryMethod" class="animate__animated animate__fadeIn">
                        <option value="videoCall">Live delivery on video call</option>
                        <option value="recorded">Recorded video of delivery</option>
                    </select>
                    <label for="platform">Choose Platform:</label>
                    <select id="platform" name="platform" class="animate__animated animate__fadeIn">
                        <option value="">-- Select Platform --</option>
                        <option value="whatsapp">WhatsApp</option>
                        <option value="googleMeet">Google Meet</option>
                        <option value="instagram">Instagram</option>
                    </select>
                    <div id="platformDetails" class="animate__animated animate__fadeIn"></div>
                `;
                
                // Add event listener for platform selection *after* the element is added to the DOM
                const platformSelect = document.getElementById("platform");
                if (platformSelect) {
                    platformSelect.addEventListener("change", handlePlatformChange);
                }
                updateFormProgress(5);
            } else {
                liveDeliveryOptions.innerHTML = '';
                updateFormProgress(-5);
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded - Final Site");
            
            // Initialize particles.js
            if (typeof particlesJS !== 'undefined') {
                particlesJS("particles-js", {
                    "particles": {
                        "number": {"value": 80, "density": {"enable": true, "value_area": 800}},
                        "color": {"value": "#FF6B6B"},
                        "shape": {"type": "circle"},
                        "opacity": {"value": 0.2, "random": false},
                        "size": {"value": 3, "random": true},
                        "line_linked": {"enable": true, "distance": 150, "color": "#FF6B6B", "opacity": 0.2, "width": 1},
                        "move": {"enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false}
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": {"onhover": {"enable": true, "mode": "grab"}, "onclick": {"enable": true, "mode": "push"}, "resize": true},
                        "modes": {"grab": {"distance": 140, "line_linked": {"opacity": 1}}, "push": {"particles_nb": 4}}
                    },
                    "retina_detect": true
                });
            } else {
                console.error('particles.js library not loaded.');
            }

            // Theme toggle functionality
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle?.querySelector('i');
            if (themeToggle && themeIcon) {
                themeToggle.addEventListener('click', function() {
                    const body = document.body;
                    body.classList.add('theme-transition');
                    if (body.classList.contains('light-mode')) {
                        body.classList.remove('light-mode');
                        themeIcon.classList.remove('fa-sun');
                        themeIcon.classList.add('fa-moon');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        body.classList.add('light-mode');
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                        localStorage.setItem('theme', 'light');
                    }
                    // Remove transition class after animation completes
                    setTimeout(() => { body.classList.remove('theme-transition'); }, 500);
                });
                
                // Apply saved theme on load
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') {
                    document.body.classList.add('light-mode');
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                }
            }

            // Initialize Google Sign-In
            initializeGoogleSignIn();
            
            // Check for saved user
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    displayUserInfo();
                    checkOrderLimit();
                    updateFormProgress(20);
                } catch (e) {
                    console.error("Error parsing saved user data:", e);
                    localStorage.removeItem('currentUser');
                }
            }
            
            // Token generation
            const customerNameInput = document.getElementById('customerName');
            const tokenDisplay = document.getElementById('tokenDisplay');
            if (customerNameInput && tokenDisplay) {
                customerNameInput.addEventListener('blur', function() {
                    if (this.value === "") {
                        tokenDisplay.textContent = "Your Token: " + generateToken();
                    } else {
                        tokenDisplay.textContent = "";
                    }
                });
                // Initial token generation if name is empty
                if (customerNameInput.value === "") {
                    tokenDisplay.textContent = "Your Token: " + generateToken();
                }
            }
            
            // Set minimum delivery date and time
            setMinDeliveryTime();
            
            // Ask button event
            const askButton = document.getElementById('askButton');
            if (askButton) askButton.addEventListener('click', showContactOptions);

            // Sign out button event
            const signOutButton = document.getElementById('sign-out-button');
            if (signOutButton) signOutButton.addEventListener('click', signOut);
            
            // Form input events for progress tracking
            const formInputs = document.querySelectorAll('#orderForm input, #orderForm textarea, #orderForm select');
            formInputs.forEach(input => {
                input.addEventListener('change', function() {
                    // Update progress only for required fields or fields with value
                    if ((this.required || this.value) && !this.dataset.counted) {
                        updateFormProgress(5);
                        this.dataset.counted = 'true';
                    } else if (!this.value && this.dataset.counted && !this.required) {
                        updateFormProgress(-5);
                        this.dataset.counted = '';
                    }
                });
            });
            
            // --- Attach Core Dynamic Event Listeners --- 
            const itemTypeSelect = document.getElementById("itemType");
            if (itemTypeSelect) {
                itemTypeSelect.addEventListener("change", handleItemTypeChange);
                console.log("Attached listener to itemType select");
            }
            
            const liveDeliveryCheckbox = document.getElementById("liveDelivery");
            if (liveDeliveryCheckbox) {
                liveDeliveryCheckbox.addEventListener("change", handleLiveDeliveryChange);
                 console.log("Attached listener to liveDelivery checkbox");
            }
            
            // Form submission
            const orderForm = document.getElementById('orderForm');
            if (orderForm) {
                orderForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    if (!this.checkValidity()) {
                        showPopup('Please fill all required fields correctly.');
                        // Optionally, highlight invalid fields
                        this.reportValidity(); 
                        return;
                    }
                    
                    const formData = new FormData(this);
                    const orderData = {};
                    for (const [key, value] of formData.entries()) {
                        // Handle checkboxes explicitly as FormData only includes them if checked
                        if (key === 'liveDelivery') {
                            orderData[key] = document.getElementById('liveDelivery')?.checked || false;
                        } else if (key === 'claimWarranty') {
                             orderData[key] = document.getElementById('claimWarranty')?.checked || false;
                        } else {
                            orderData[key] = value;
                        }
                    }
                    // Ensure totalAmount is calculated and added
                    orderData.totalAmount = calculateTotalAmount();
                    
                    const submitButton = document.getElementById('submit-button');
                    const originalText = submitButton?.innerHTML || 'Proceed to Payment <i class="fas fa-arrow-right"></i>';
                    if (submitButton) {
                        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                        submitButton.disabled = true;
                    }
                    
                    try {
                        let success = false;
                        // Try Supabase first if user is logged in
                        if (currentUser && supabase) {
                            console.log("Attempting Supabase submission...");
                            success = await storeOrderSupabase(orderData);
                            console.log("Supabase submission result:", success);
                        }
                        // Fallback to Google Apps Script if Supabase fails or user not logged in
                        if (!success) {
                            console.log("Attempting Google Apps Script submission...");
                            success = await submitFormDataGoogle(orderData);
                             console.log("Google Apps Script submission result:", success);
                        }
                        
                        if (success) {
                            showPopup('Your order has been submitted successfully! We will contact you shortly.');
                            this.reset(); // Reset the form
                            // Manually clear dynamic sections and reset token/amount
                            document.getElementById('additionalSections').innerHTML = '';
                            document.getElementById('liveDeliveryOptions').innerHTML = '';
                            document.getElementById('totalAmount').textContent = 'Total Amount: ₹0';
                            if (tokenDisplay && customerNameInput?.value === "") {
                                tokenDisplay.textContent = "Your Token: " + generateToken();
                            }
                            updateFormProgress(100); // Show completion
                            setTimeout(() => updateFormProgress(-100), 1000); // Reset progress
                            checkOrderLimit(); // Re-check limit after successful order
                        } else {
                            showPopup('There was an error submitting your order. Please try again or contact support.');
                        }
                    } catch (error) {
                        console.error('Order submission error:', error);
                        showPopup('There was an error submitting your order. Please try again.');
                    } finally {
                        if (submitButton) {
                            submitButton.innerHTML = originalText;
                            // Re-enable button only if order limit not reached
                            checkOrderLimit(); 
                        }
                    }
                });
            }
            
            // Sticky navigation
            window.addEventListener('scroll', function() {
                const nav = document.getElementById('mainNav');
                if (nav) {
                    if (window.scrollY > 100) {
                        nav.classList.add('scrolled');
                    } else {
                        nav.classList.remove('scrolled');
                    }
                }
            });
            
            // Initialize 3D card effect
            const cards = document.querySelectorAll('.card-3d');
            cards.forEach(card => {
                card.addEventListener('mousemove', function(e) {
                    const cardInner = card.querySelector('.card-3d-inner');
                    if (!cardInner) return;
                    const cardRect = card.getBoundingClientRect();
                    const cardCenterX = cardRect.left + cardRect.width / 2;
                    const cardCenterY = cardRect.top + cardRect.height / 2;
                    const mouseX = e.clientX - cardCenterX;
                    const mouseY = e.clientY - cardCenterY;
                    const rotateY = mouseX / 15; // Reduced rotation intensity
                    const rotateX = -mouseY / 15; // Reduced rotation intensity
                    cardInner.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
                });
                card.addEventListener('mouseleave', function() {
                     const cardInner = card.querySelector('.card-3d-inner');
                     if (cardInner) cardInner.style.transform = 'rotateY(0deg) rotateX(0deg)';
                });
            });
            
            console.log("All initializations and event listeners attached - Final Site");
        });
    </script> 
 </body>
</html>
